<VirtualHost "*:HTTP_PORT">
    ServerName auth.LDAP_DOMAIN
    CustomLog /dev/stdout modremoteip
    Include SSL_TOGGLE_INCLUDE
    LogLevel LOG_LEVEL
    DocumentRoot /usr/share/lemonldap-ng/portal/htdocs/
    <Directory /usr/share/lemonldap-ng/portal/htdocs/>
	<IfVersion >= 2.3>
	    Require all granted
	</IfVersion>
	<IfVersion < 2.3>
	    Order Deny,Allow
	    Allow from all
	</IfVersion>
	Options +ExecCGI +FollowSymLinks
    </Directory>
    RewriteEngine On
    RewriteCond "%{REQUEST_FILENAME}" "!^/(?:(?:static|javascript|favicon).*|.*\.fcgi)$"
    RewriteRule "^/(.+)$" "/index.fcgi/$1" [PT]
    <Files *.fcgi>
	SetHandler fcgid-script
	Options +ExecCGI
	header unset Lm-Remote-User
    </Files>
    Alias /static/ /usr/share/lemonldap-ng/portal/htdocs/static/
    <Directory /usr/share/lemonldap-ng/portal/htdocs/static/>
	<IfVersion >= 2.3>
	    Require all granted
	</IfVersion>
	<IfVersion < 2.3>
	    Order Deny,Allow
	    Allow from all
	</IfVersion>
	Options +FollowSymLinks
    </Directory>
    <Location /static/>
	<IfModule mod_expires.c>
	    ExpiresActive On
	    ExpiresDefault "access plus 1 month"
	</IfModule>
    </Location>
    <IfModule mod_dir.c>
	DirectoryIndex index.fcgi index.html
    </IfModule>
    <Location /index.fcgi/adminSessions>
	<IfVersion >= 2.3>
	    Require all granted
	</IfVersion>
	<IfVersion < 2.3>
	    Order Allow,Deny
	    Allow from all
	</IfVersion>
    </Location>
    <Location /index.fcgi/sessions>
	<IfVersion >= 2.3>
	    Require all granted
	</IfVersion>
	<IfVersion < 2.3>
	    Order Allow,Deny
	    Allow from all
	</IfVersion>
    </Location>
    <Location /index.fcgi/config>
	<IfVersion >= 2.3>
	    Require all granted
	</IfVersion>
	<IfVersion < 2.3>
	    Order Allow,Deny
	    Allow from all
	</IfVersion>
    </Location>
    <Location /index.fcgi/notification>
	<IfVersion >= 2.3>
	    Require all granted
	</IfVersion>
	<IfVersion < 2.3>
	    Order Allow,Deny
	    Allow from all
	</IfVersion>
    </Location>
    <Location />
	<IfModule mod_deflate.c>
	    AddOutputFilterByType DEFLATE text/html text/plain text/xml text/javascript text/css
	    SetOutputFilter DEFLATE
	    BrowserMatch ^Mozilla/4 gzip-only-text/html
	    BrowserMatch ^Mozilla/4\.0[678] no-gzip
	    BrowserMatch \bMSIE !no-gzip !gzip-only-text/html
	    SetEnvIfNoCase Request_URI \.(?:gif|jpe?g|png)$ no-gzip dont-vary
	</IfModule>
	<IfModule mod_headers.c>
	    Header append Vary User-Agent env=!dont-vary
	</IfModule>
    </Location>
</VirtualHost>
